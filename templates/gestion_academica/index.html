{% extends "gestion_academica/home.html" %}
<head>  
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- Ionicons -->
    <link rel="stylesheet" href="https://unpkg.com/ionicons@5.5.2/dist/css/ionicons.min.css">

    <!-- AdminLTE CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/css/adminlte.min.css">

    <!-- JQVMap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jqvmap.min.css">
</head> 

{% block titulo %} Inicio {% endblock %}
{% block contenido %}

<style>
    .small-box {
        display: flex;
        flex-direction: column; 
        justify-content: center; 
        align-items: center;
        main-height: 100%;  
        border-radius: 8px; 
        position: relative; 
        margin-bottom: 1px; /* Espacio inferior entre cajas */
    }

    .small-box .icon {
        color: rgba(0, 0, 0, 0.15);
        font-size: 70px;  
        position: absolute;  
        top: 10px;  
        right: 15px;  
        z-index: 0; 
    }

    .small-box h4 {
        color: #ffffff; 
    }

    .small-box h1 {
        color: white; 
        font-weight: bold; 
        font-size: 3rem;
        display: block; 
    }
    
    .small-box .small-box-footer {
        background: rgba(0, 0, 0, 0.1);
        color: #000;
        display: block;
        padding: 3px 0;
        position: relative;
        text-align: center;
        text-decoration: none;
        z-index: 10;
    }
</style>

    <div class="container-fluid p-0">
        <h1 class="h3 mb-3" style="display: block; visibility: visible; color: black;"><strong>Dashboard Informativo</strong></h1>
    </div>


    <div class="container">
        <div class="row">
            <!-- PRIMERA COLUMNA -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="small-box bg-info shadow-sm rounded">
                    <div class="inner">
                        <h1>
                            {{ estadisticas['registrados'] }}
                        </h1>
                        <h4>Estudiantes Registrados</h4>
                    </div>
                </div>
            </div>

            <!-- SEGUNDA COLUMNA -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="small-box bg-success">
                    <div class="inner">
                        <h1>
                            {{ estadisticas['proceso'] }}
                        </h1>
                        <h4>Prácticas en Curso</h4>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                </div>
            </div>

            <!-- TERCERA COLUMNA -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="small-box bg-warning">
                    <div class="inner">
                        <h1>
                            {{ estadisticas['espera_informes']}}
                        </h1>
                        <h4>Espera de Informes</h4>
                    </div>
                    <div class="icon">
                        <i class="ion ion-person-add"></i>
                    </div>
                </div>
            </div>

            <!-- CUARTA COLUMNA -->
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="small-box bg-primary shadow-sm roundeds">
                    <div class="inner">
                        <h1>
                            {{ estadisticas['finalizada']}}
                        </h1>
                        <h4>Prácticas Finalizas</h4>
                    </div>
                    <div class="icon">
                        <i class="ion ion-pie-graph"></i>
                    </div>
                </div>
            </div>
        </div> 

        <div class="row mt-3">
            <!-- Custom tabs (Charts with tabs)-->
            <div class="col-lg-6 mb-4">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie mr-1"></i>
                            Gráfico Estudiantes por Ciclo
                        </h3>
                        <div class="card-tools">
                            <ul class="nav nav-pills ml-auto">
                            </ul>
                        </div>
                    </div>

                    <div class="card-body">
                        <div class="tab-content p-0">
                            <div class="chart tab-pane active" id="revenue-chart" style="position: relative; height: 300px;">
                                <canvas id="revenue-chart-canvas" height="300" style="height: 300px;"></canvas>
                            </div>
                            <div class="chart tab-pane" id="sales-chart" style="position: relative; height: 300px;">
                                <canvas id="sales-chart-canvas" height="300" style="height: 300px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gráfico de torta-->
            <div class="col-lg-6 mb-4">
                <div class="card card-primary card-outline">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="far fa-chart-bar"></i>
                            Gráfico de torta
                        </h3>
                    </div>
                    <div class="card-body" style="display: flex; justify-content: center; align-items: center;">
                        <!-- Canvas para Chart.js centrado -->
                        <div id="donut-chart" style="height: 300px; width: 300px; padding: 0px; position: relative;">
                            <canvas id="donutChart" width="300" height="300"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        
        </div> 

    </div>

    <!-- Scripts al final del body -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>

    <!-- AdminLTE JS -->
    <script src="https://cdn.jsdelivr.net/npm/admin-lte@3.1/dist/js/adminlte.min.js"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <!-- Adaptador de fechas para Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0"></script>

    <!-- Mapa -->
    <script src="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/jquery.vmap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jqvmap@1.5.1/dist/maps/jquery.vmap.world.js"></script>

    <script>
        // Datos de prueba para el gráfico
        var registrosPorFecha = [
            { fecha: '2024-06-04', cantidad_registrados: 1 },
            { fecha: '2024-07-05', cantidad_registrados: 2 },
            { fecha: '2024-08-04', cantidad_registrados: 8 },
            { fecha: '2024-09-05', cantidad_registrados: 2 },
            { fecha: '2024-10-04', cantidad_registrados: 10 },
            { fecha: '2024-11-05', cantidad_registrados: 2 },
        ];

        var fechas = registrosPorFecha.map(r => new Date(r.fecha));
        var cantidades = registrosPorFecha.map(r => r.cantidad_registrados);

        // Script para Gráfico de líneas
        var ctxRevenue = document.getElementById('revenue-chart-canvas').getContext('2d');
        var revenueChart = new Chart(ctxRevenue, {
            type: 'line',
            data: {
                labels: fechas,
                datasets: [{
                    label: 'Estudiantes Registrados por Ciclo',
                    data: cantidades,
                    borderColor: 'rgba(60,141,188,0.8)',
                    backgroundColor: 'rgba(60,141,188,0.4)',
                    fill: true, 
                    tension: 0.4,
                    borderWidth: 2
                }]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true,
                scales: {
                    x: {
                        type: 'time',
                        time: {
                            unit: 'day',
                            displayFormats: {
                                day: 'MMM dd'
                            }
                        },
                        title: {
                            display: true,
                            text: 'Ciclo'
                        },
                        ticks: {
                            autoSkip: true,
                            maxTicksLimit: 7
                        }
                    },
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Cantidad de Estudiantes'
                        },
                        ticks: {
                            stepSize: 1,
                            callback: function(value) { return Number.isInteger(value) ? value : null; }
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: true,
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                interaction: {
                    mode: 'nearest',
                    intersect: false,
                    axis: 'x'
                }
            }
        });

        //Script para el Gráfico de torta
        const totalConFecha = {{ ppp_finalizadas['total_con_fecha']}}; 
        const totalSinFecha = {{ ppp_finalizadas['total_sin_fecha']}}; 

        //Configuración el gráfico usando Chart.js
        const ctx = document.getElementById('donutChart').getContext('2d');
        const donutChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Prácticas Finalizadas', 'Prácticas Iniciadas'],
                datasets: [{
                    label: 'Prácticas Preprofesionales',
                    data: [totalConFecha, totalSinFecha],
                    backgroundColor: [
                        'rgba(0, 123, 255, 0.7)',  // Azul fuerte para 'Con Fecha'
                        'rgba(255, 165, 0, 0.7)'   // Anaranjado para 'Sin Fecha'
                    ],
                    borderColor: [
                        'rgba(0, 123, 255, 1)',
                        'rgba(255, 165, 0, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.label + ': ' + context.raw;
                            }
                        }
                    },
                    datalabels: {
                        color: '#fff',
                        font: {
                            size: 16,
                            weight: 'bold'
                        },
                        formatter: (value, ctx) => {
                            return value; // Muestra el valor directamente en el gráfico
                        }
                    }
                }
            },
            plugins: [ChartDataLabels]
        });

        $(document).ready(function() {
            $('#world-map').vectorMap({
                map: 'world_en',
                backgroundColor: 'transparent',
                color: '#ffffff',
                hoverOpacity: 0.7,
                selectedColor: '#666666',
                enableZoom: true,
                showTooltip: true,
                values: {},
                scaleColors: ['#C8EEFF', '#0071A4'],
                normalizeFunction: 'polynomial'
            });
        });
    </script>
{% endblock %}
